<div class="row">
    <div class="col">
        <p-panel header="Change URL" [toggleable]="true" [collapsed]="true" toggler="header" styleClass="shadow-1">
            <p-messages [(value)]="version12Message" [enableService]="false" />
            <p-iconField iconPosition="left">
                <p-inputIcon styleClass="pi pi-link" />
                <input type="url" class="w-full" pInputText placeholder="Convene URL" />
            </p-iconField>
            <p-button label="Refresh History" icon="pi pi-refresh" iconPos="right" styleClass="mt-2" />
        </p-panel>
    </div>
</div>

<!-- desktop view -->
<div class="row gap-2 d-none d-lg-flex">
    <div class="col-12 xl:col">
        <div class="h-100">
            <div class="row gap-2">
                <div class="col">
                    <div class="card border border-100 shadow-1">
                        <div class="text-xl">Pity</div>
                    </div>
                </div>
                <div class="col">
                    <div class="card border border-100 shadow-1">
                        <div class="grid">
                            <div class="col-12 flex justify-content-between">
                                <div class="text-xl">Luck</div>
                                <p-selectButton [options]="qualityLevels" [(ngModel)]="selectedQualityLevel"
                                    optionLabel="label" optionValue="value" [allowEmpty]="false" />
                            </div>
                            <div class="col">
                                <p-skeleton *ngIf="!selectedBanner || !selectedBanner.stats" class="w-100"
                                    height="14rem"></p-skeleton>

                                <div *ngIf="selectedBanner && selectedBanner.stats">
                                    <ng-container
                                        *ngIf="selectedQualityLevel === 5; then fiveStarStats else fourStarStats"></ng-container>

                                    <ng-template #fiveStarStats>
                                        <div class="grid gap">
                                            <div class="col-4">
                                                <div class="text-lg">
                                                    No. of
                                                    <span class="text-five-star">5★ pulls</span>
                                                    <span class="text-2xl ms-2 animated-underline"
                                                        pTooltip="You pulled {{selectedBanner.stats.fiveStar.count}} 5★">
                                                        {{selectedBanner.stats.fiveStar.count}}
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="col-4">
                                                <div class="text-lg">
                                                    Avg. Pity
                                                    <span class="text-five-star">5★</span>
                                                    <span class="text-2xl ms-2 animated-underline"
                                                        [class]="getPityClass(5, selectedBanner.stats.fiveStar.avgPity)"
                                                        pTooltip="You averaged {{selectedBanner.stats.fiveStar.avgPity}} pulls to get a 5★">
                                                        {{(selectedBanner.stats.fiveStar.avgPity || 0) | number:
                                                        '1.0-0'}}
                                                        <span class="text-sm text-color">/80</span>
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="col-4">
                                                <div class="text-lg">
                                                    50-50s won
                                                    <span class="text-five-star">5★</span>
                                                    <span class="text-2xl ms-2 animated-underline"
                                                        pTooltip="You won fifty-fifty {{selectedBanner.stats.fiveStar.wonFiftyFifty}} times">
                                                        {{selectedBanner.stats.fiveStar.wonFiftyFifty}}
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="text-lg">Chance of getting a
                                                    <span class="text-five-star">5★</span>
                                                </div>
                                                <p-progressBar [value]="selectedBanner.stats.fiveStar.qualityPercentage"
                                                    mode="determinate" [showValue]="false" styleClass="mt-2"
                                                    pTooltip="You had a {{selectedBanner.stats.fiveStar.qualityPercentage | number: '1.0-2'}}% chance of getting a 5★"
                                                    tooltipPosition="bottom" />
                                            </div>
                                        </div>
                                    </ng-template>
                                    <ng-template #fourStarStats>
                                        <div class="grid gap">
                                            <div class="col-4">
                                                <div class="text-lg">
                                                    No. of
                                                    <span class="text-four-star">4★ pulls</span>
                                                    <span class="text-2xl ms-2 animated-underline"
                                                        pTooltip="You pulled {{selectedBanner.stats.fiveStar.count}} 4★">
                                                        {{selectedBanner.stats.fiveStar.count}}
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="col-4">
                                                <div class="text-lg">
                                                    Avg. Pity
                                                    <span class="text-four-star">4★</span>
                                                    <span class="text-2xl ms-2 animated-underline"
                                                        [class]="getPityClass(4, selectedBanner.stats.fourStar.avgPity)"
                                                        pTooltip="You averaged {{selectedBanner.stats.fourStar.avgPity}} pulls to get a 4★">
                                                        {{(selectedBanner.stats.fourStar.avgPity || 0) | number:
                                                        '1.0-0'}}
                                                        <span class="text-sm text-color">/10</span>
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="col-4">
                                                <div class="text-lg">
                                                    50-50s won
                                                    <span class="text-four-star">4★</span>
                                                    <span class="text-2xl ms-2 animated-underline"
                                                        pTooltip="You won fifty-fifty {{selectedBanner.stats.fourStar.wonFiftyFifty}} times">
                                                        {{selectedBanner.stats.fourStar.wonFiftyFifty}}
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="text-lg">Chance of getting a
                                                    <span class="text-four-star">4★</span>
                                                </div>
                                                <p-progressBar [value]="selectedBanner.stats.fourStar.qualityPercentage"
                                                    mode="determinate" [showValue]="false" styleClass="mt-2"
                                                    pTooltip="You had a {{selectedBanner.stats.fourStar.qualityPercentage | number: '1.0-2'}}% chance of getting a 4★"
                                                    tooltipPosition="bottom" />
                                            </div>
                                        </div>
                                    </ng-template>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="card border border-100 shadow-1">
                        <div class="text-xl">Recent</div>

                        <p-chart type="line" [data]="pityChartData" [options]="pityChartOptions" />

                        <div class="banner-history mt-2">
                            <div class="banner-history__item" *ngFor="let item of selectedBannerHistory">
                                <img class="banner-history__item-image"
                                    [ngSrc]="'images/characters/head-80/T_IconRoleHead80_' + item.name.toLowerCase() + '_UI.png'"
                                    [class.five-star]="item.qualityLevel === 5" [alt]="item.name" height="64" width="64"
                                    pTooltip="Obtained {{item.name}} on {{item.time | date: 'MMM d'}}"
                                    *ngIf="item.resourceType === 'Resonator'">
                                <img class="banner-history__item-image"
                                    [ngSrc]="'images/weapons/weapons-80/T_IconWeapon80_' + item.resourceId + '_UI.png'"
                                    [class.five-star]="item.qualityLevel === 5" [alt]="item.name" height="64" width="64"
                                    pTooltip="Obtained {{item.name}} on {{item.time | date: 'MMM d'}}"
                                    *ngIf="item.resourceType === 'Weapon'">

                                <i class="banner-history__item-quality pi bi-stars"
                                    [class.won-5050]="item.wonFiftyFifty" pTooltip="Won the 50/50!"
                                    *ngIf="item.qualityLevel > 4 && item.wonFiftyFifty"></i>
                                <span class="banner-history__item-pity"
                                    [class]="getPityClass(item.qualityLevel, item.pity)">{{item.pity}}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-5 xl:col-3">
        <div class="card border border-100 h-100 shadow-1">
            <div class="text-2xl">Banners</div>

            <div class="banner-list__container">
                <div class="col gap-2 banner-list min-h-30rem">
                    <div class="banner-card border border-100 border rounded" *ngFor="let banner of displayBanners"
                        [class.selected]="selectedBanner?.key === banner.key" (click)="selectBanner(banner)">
                        <img class="banner-card__image" [src]="'images/gacha/' + banner.key + '.png'"
                            alt="banner.name" />
                        <div class="banner-card__title text-lg">{{banner.name}}</div>
                        <p class="text-five-star">
                            <span class="text-2xl">
                                {{banner.pity?.fiveStar || 0}}
                            </span>
                            <span class="opacity-75">/ 80</span>
                        </p>
                        <p class="text-four-star">
                            <span class="text-2xl">
                                {{banner.pity?.fourStar || 0}}
                            </span>
                            <span class="opacity-75">/ 10</span>
                        </p>
                    </div>
                </div>
                <div class="banner-list__shade_top"></div>
                <div class="banner-list__shade_bottom"></div>
            </div>
        </div>
    </div>
</div>